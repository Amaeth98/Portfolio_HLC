FROM ubuntu


RUN apt update && apt install -yq --no-install-recommends \
    nano \
    git curl \
    iputils-ping net-tools \
    sudo \
    openssh-server 

# Copiar los script's del entrypoint (sc ppal --> otros sc's personalizados)

RUN mkdir -p /root/admin/base
WORKDIR /root/admin/base
# 1 . --> relativo al directorio (base) donde se encuentra ubbase --> docker build
#COPY ./admin/start.sh .

# 1er . --> relativo a la ruta del contexto (caronte) en el Docker-compose.yml del proyecto base
# docker compose up -d --build
# 2o . --> workdir dentro del contenedor
COPY ./Dockerfiles/base/admin/ .
RUN mkdir ./common
COPY ./common/id_rsa.pub /root/admin/base/common
RUN service ssh start && \
    mkdir /root/.ssh && \
    cat ./common/id_rsa.pub >> /root/.ssh/authorized_keys && \
    chmod 600 /root/.ssh/authorized_keys

RUN chmod +x ./start.sh

ENTRYPOINT [ "./start.sh" ]